<!DOCTYPE html><html lang="ja">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>テスト一覧</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/minecraft-font.css">
</head>
<body class="test-bg">
<div class="container" id="testList">
  <h2 style="margin-bottom:20px">📝 漢字読解テスト一覧</h2>
</div>

<script type="module">
import { getArchive, playClick } from './js/app.js';

const listElm = document.getElementById('testList');

/* tests.json は index.html と同じ階層に置く想定 → "./tests.json" */
fetch('./tests.json')
  .then(res => {
    if (!res.ok) throw new Error('tests.json が読み込めません');
    return res.json();
  })
  .then(data => {
    if (!data.tests || !data.tests.length) {
      listElm.innerHTML += '<p>テストが定義されていません。</p>';
      return;
    }

    data.tests.forEach(test => {
      // アーカイブ済みは表示しない
      if (getArchive().includes(test.id)) return;

      const a = document.createElement('a');
      a.href = `single_test.html?id=${test.id}`;
      a.className = 'btn';
      a.textContent = `▶ テスト${test.id}`;
      a.addEventListener('click', playClick);
      listElm.appendChild(a);
    });

    /* テストが 0 件しかなければメッセージ */
    if (listElm.querySelectorAll('.btn').length === 0) {
      listElm.innerHTML += '<p>表示できるテストがありません。</p>';
    }
  })
  .catch(err => {
    console.error(err);
    listElm.innerHTML += `<p style="color:red">${err.message}</p>`;
  });
</script>
</body></html>
